import{_ as te}from"./ConnectionStatus-BuvQ7FbR.js";import{_ as Y,V as ae}from"./VContainer-BY01WYsX.js";import{_ as se,o as oe,a as le,c as L,g as re,b as ne,r,u as ie,d as i,w as s,e as a,f as o,t as l,V as q,h as p,i as _,j as m,k as J,F as ue,l as de,m as N,n as ce,p as pe,q as me,s as ve,v as fe,x as ge,y as v,z as ye,A as he}from"./index-CKh2z7Xl.js";import{V as F}from"./VAlert-BH0LAnza.js";import{V as C}from"./VChip-qdZfEUql.js";import{V as _e,a as xe}from"./VRow-Cd8JKBFL.js";const be="0.2.11",we={version:be},Ue={class:"d-flex flex-column flex-sm-row justify-space-between align-start align-sm-center mb-6 gap-3"},Ve={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center ga-3"},Ce={class:"text-body-2"},Te={key:1,class:"text-center py-16"},ke={class:"text-body-2"},De={key:0,class:"text-caption text-secondary mt-2"},Me={key:3,class:"d-flex flex-column ga-4"},Pe={class:"text-h5 text-primary-high font-weight-bold"},Se={class:"text-body-2 text-secondary"},Ae={class:"d-flex ga-2 flex-wrap"},Ee={class:"d-flex justify-space-between align-center mb-2"},$e={class:"text-center mt-2"},Le={class:"text-caption text-secondary"},Ne={key:0,class:"text-caption"},Fe={key:1,class:"text-caption"},Oe={key:2,class:"text-caption text-error"},Ie=3e3,je=60,ze=70,Be=80,Re={__name:"index",setup(Ye){const{success:X,error:T}=ie(),H=we.version,k=r(!1),x=r(null),D=r(!0),n=r(null),O=r(""),d=r(null),b=r(null),w=r(!1),U=r(!1),V=r("Starting update..."),y=r(null),M=r(""),P=r(!1),S=r("");let A=null,f=null;const I=v(()=>{if(!d.value)return[];const t=[];return d.value.code&&t.push(`Code: ${d.value.code}`),d.value.status&&t.push(`Status: ${d.value.status}`),d.value.requestUrl&&t.push(`URL: ${d.value.requestUrl}`),t}),G=v(()=>{const t=b.value?.components?.[0];return t?`${t.name}: ${t.current_version} → ${t.latest_version}`:"A system update is available."}),j=v(()=>Math.round(Number(n.value?.cpu?.usage_percent??n.value?.cpu?.usage??0))),z=v(()=>Math.round(Number(n.value?.memory?.percent??n.value?.memory?.percent_used??0))),B=v(()=>Math.round(Number(n.value?.disk?.percent??n.value?.disk?.percent_used??0))),g=v(()=>Number(n.value?.temperature?.celsius??n.value?.temperature?.temp_c??0)),h=v(()=>g.value>=Be?{color:"error",alertType:"error",message:"Your CDO Vertex is running hot. Temperature is in the critical range; the system may throttle to prevent damage."}:g.value>=ze?{color:"warning",alertType:"warning",message:"Your CDO Vertex is above the ideal 70°C. Ensure it is not in direct sunlight and the vent has room for airflow."}:g.value>=je?{color:"info",alertType:"info",message:"Your CDO Vertex is operating in normal temperatures under typical use."}:{color:"success",alertType:"success",message:"Your CDO Vertex is operating in normal temperatures."});function R(t){return t>=90?"error":t>=70?"warning":"success"}function W(t){return t>=95?"error":t>=85?"warning":"success"}function K(t){const e=Number(t||0),c=Math.floor(e/86400),u=Math.floor(e%86400/3600),ee=Math.floor(e%3600/60);return`${c}d ${u}h ${ee}m`}async function E(){try{k.value=!0,x.value=null;const t=await re();n.value=t.data,D.value=!0,O.value=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){x.value=t.message,d.value=t,D.value=!1,T("Failed to fetch dashboard data: "+t.message)}finally{k.value=!1}}async function $(){try{const t=await ne(),e=t.data?.components||[];b.value=e.some(c=>c.update_available)?t.data:null}catch{b.value=null}}async function Q(){try{w.value=!0;const e=(await ye()).data||{};e.started||e.success?(y.value=e.job_id||null,M.value=e.log_path||"",V.value="Applying update. Please keep this page open.",P.value=!1,S.value="",U.value=!0,y.value&&await Z(y.value),X("Update started. The device will restart when finished.")):T(e.error||"Update command failed to start."),await $()}catch(t){T("Failed to apply update: "+t.message)}finally{w.value=!1}}oe(async()=>{await E(),await $(),A=setInterval(()=>{E(),$()},5e3)}),le(()=>{A&&clearInterval(A),f&&clearTimeout(f)});async function Z(t){if(!t)return;const e=async()=>{try{const u=(await he(t)).data||{};if(V.value=u.running?"Installing update...":"Finalizing update...",u.finished){if(u.success===!1||u.error){P.value=!0,S.value=u.error||"Update failed. Check the log for details.";return}U.value=!1,window.location.reload();return}}catch{V.value="Waiting for the device to respond..."}f=setTimeout(e,Ie)};f&&clearTimeout(f),f=setTimeout(e,0)}return(t,e)=>(i(),L(ae,{class:"pa-4 pa-md-6",fluid:""},{default:s(()=>[a("div",Ue,[e[1]||(e[1]=a("div",null,[a("h1",{class:"text-h4 text-md-h3 text-primary-high font-weight-bold mb-1"},"Dashboard"),a("p",{class:"text-body-2 text-secondary"},"At-a-glance device health")],-1)),o(te,{connected:D.value},null,8,["connected"])]),b.value?.components?.length?(i(),L(F,{key:0,class:"mb-4",color:"warning",icon:"mdi-update",type:"warning",variant:"tonal"},{default:s(()=>[a("div",Ve,[a("div",null,[e[2]||(e[2]=a("div",{class:"text-subtitle-1 font-weight-bold"},"Update available",-1)),a("div",Ce,l(G.value),1)]),o(q,{color:"warning",disabled:w.value,loading:w.value,"prepend-icon":"mdi-download",onClick:Q},{default:s(()=>[...e[3]||(e[3]=[p("Update now",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):_("",!0),k.value&&!n.value?(i(),m("div",Te,[o(J,{color:"primary",indeterminate:"",size:"64"}),e[4]||(e[4]=a("div",{class:"text-body-1 text-secondary mt-4"},"Loading dashboard...",-1))])):x.value?(i(),L(F,{key:2,class:"mb-6",icon:"mdi-alert-circle",prominent:"",type:"error",variant:"tonal"},{append:s(()=>[o(q,{color:"error",variant:"outlined",onClick:E},{default:s(()=>[...e[5]||(e[5]=[p("Retry",-1)])]),_:1})]),default:s(()=>[e[6]||(e[6]=a("div",{class:"text-h6 mb-2"},"Connection Error",-1)),a("div",ke,l(x.value),1),I.value.length>0?(i(),m("div",De,[(i(!0),m(ue,null,de(I.value,(c,u)=>(i(),m("div",{key:u},l(c),1))),128))])):_("",!0)]),_:1})):(i(),m("div",Me,[o(Y,{elevated:""},{default:s(()=>[o(N,{class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center ga-4"},{default:s(()=>[a("div",null,[e[7]||(e[7]=a("div",{class:"text-overline text-secondary"},"Device summary",-1)),a("div",Pe,l(n.value?.hostname?.hostname||"CDO Vertex"),1),a("div",Se," Uptime "+l(K(n.value?.uptime?.uptime_seconds||0))+" · Dashboard v"+l(ce(H)),1)]),a("div",Ae,[o(C,{color:R(j.value),"prepend-icon":"mdi-chip",variant:"tonal"},{default:s(()=>[p(l(j.value)+"% CPU",1)]),_:1},8,["color"]),o(C,{color:W(z.value),"prepend-icon":"mdi-memory",variant:"tonal"},{default:s(()=>[p(l(z.value)+"% Memory",1)]),_:1},8,["color"]),o(C,{color:R(B.value),"prepend-icon":"mdi-harddisk",variant:"tonal"},{default:s(()=>[p(l(B.value)+"% Disk",1)]),_:1},8,["color"]),o(C,{color:h.value.color,"prepend-icon":"mdi-thermometer",variant:"tonal"},{default:s(()=>[p(l(g.value.toFixed(1))+"°C",1)]),_:1},8,["color"])])]),_:1})]),_:1}),o(_e,null,{default:s(()=>[o(xe,{cols:"12",lg:"12",md:"12"},{default:s(()=>[o(Y,{class:"h-100 hoverable-card"},{default:s(()=>[o(pe,{class:"text-primary-high"},{default:s(()=>[...e[8]||(e[8]=[p("Temperature",-1)])]),_:1}),o(N,null,{default:s(()=>[a("div",Ee,[e[9]||(e[9]=a("span",{class:"text-body-2 text-secondary"},"CPU Temperature",-1)),a("span",{class:me(["text-h5",`text-${h.value.color}`])},l(g.value.toFixed(1))+"°C",3)]),o(ve,{color:h.value.color,height:"12","model-value":Math.min(Math.max(g.value,0),100),rounded:""},null,8,["color","model-value"]),o(F,{class:"mt-3",density:"comfortable",type:h.value.alertType,variant:"tonal"},{default:s(()=>[p(l(h.value.message),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})]),_:1}),a("div",$e,[a("div",Le,"Last updated: "+l(O.value),1)])])),o(fe,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=c=>U.value=c),persistent:"","max-width":"460"},{default:s(()=>[o(ge,{class:"dialog"},{default:s(()=>[o(N,{class:"dialog__body"},{default:s(()=>[o(J,{indeterminate:"",size:"56",width:"5",color:"primary"}),a("div",null,[e[10]||(e[10]=a("h3",null,"Updating device",-1)),a("p",null,l(V.value),1),y.value?(i(),m("p",Ne,"Job "+l(y.value),1)):_("",!0),M.value?(i(),m("p",Fe,"Log: "+l(M.value),1)):_("",!0),P.value?(i(),m("p",Oe,l(S.value),1)):_("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ke=se(Re,[["__scopeId","data-v-705cdb5f"]]);export{Ke as default};
