import{_ as G}from"./ConnectionStatus-DbShbmyM.js";import{_ as L,V as S,a as J,b as K}from"./VContainer-BMR2f8gZ.js";import{o as Q,a as W,c as T,g as Z,b as ee,d as te,r as l,u as ae,e as u,w as s,f as a,h as r,t as o,V as O,i as d,j as F,k as f,l as se,F as re,m as oe,n as ne,p as le,q as ie,s as m,v as ue}from"./index-ByZU1jn9.js";import{V as D}from"./VAlert-D7jMvYQU.js";import{V as _}from"./VChip-DzKLjb3U.js";import{V as de,a as ce}from"./VRow-DmYayam2.js";const me="0.2.5",pe={version:me},ve={class:"d-flex flex-column flex-sm-row justify-space-between align-start align-sm-center mb-6 gap-3"},fe={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center ga-3"},ye={class:"text-body-2"},he={key:1,class:"text-center py-16"},ge={class:"text-body-2"},_e={key:0,class:"text-caption text-secondary mt-2"},xe={key:3,class:"d-flex flex-column ga-4"},be={class:"text-h5 text-primary-high font-weight-bold"},we={class:"text-body-2 text-secondary"},Ce={class:"d-flex ga-2 flex-wrap"},Ve={class:"d-flex justify-space-between align-center mb-2"},Ue={class:"text-center mt-2"},ke={class:"text-caption text-secondary"},Me=60,Te=70,De=80,Se={__name:"index",setup($e){const{success:R,error:x}=ae(),B=pe.version,b=l(!1),y=l(null),w=l(!0),n=l(null),C=l(""),$=l(""),i=l(null),h=l(null),g=l(!1);let V=null;const P=m(()=>{if(!i.value)return[];const e=[];return i.value.code&&e.push(`Code: ${i.value.code}`),i.value.status&&e.push(`Status: ${i.value.status}`),i.value.requestUrl&&e.push(`URL: ${i.value.requestUrl}`),e}),I=m(()=>{const e=h.value?.components?.[0];return e?`${e.name}: ${e.current_version} → ${e.latest_version}`:"A system update is available."}),A=m(()=>Math.round(Number(n.value?.cpu?.usage_percent??n.value?.cpu?.usage??0))),E=m(()=>Math.round(Number(n.value?.memory?.percent??n.value?.memory?.percent_used??0))),N=m(()=>Math.round(Number(n.value?.disk?.percent??n.value?.disk?.percent_used??0))),p=m(()=>Number(n.value?.temperature?.celsius??n.value?.temperature?.temp_c??0)),v=m(()=>p.value>=De?{color:"error",alertType:"error",message:"Your CDO Vertex is running hot. Temperature is in the critical range; the system may throttle to prevent damage."}:p.value>=Te?{color:"warning",alertType:"warning",message:"Your CDO Vertex is above the ideal 70°C. Ensure it is not in direct sunlight and the vent has room for airflow."}:p.value>=Me?{color:"info",alertType:"info",message:"Your CDO Vertex is operating in normal temperatures under typical use."}:{color:"success",alertType:"success",message:"Your CDO Vertex is operating in normal temperatures."});function j(e){return e>=90?"error":e>=70?"warning":"success"}function H(e){return e>=95?"error":e>=85?"warning":"success"}function Y(e){const t=Number(e||0),c=Math.floor(t/86400),M=Math.floor(t%86400/3600),z=Math.floor(t%3600/60);return`${c}d ${M}h ${z}m`}async function U(){try{b.value=!0,y.value=null;const e=await ee();n.value=e.data,w.value=!0,$.value=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(e){y.value=e.message,i.value=e,w.value=!1,x("Failed to fetch dashboard data: "+e.message)}finally{b.value=!1}}async function q(){try{const e=await Z();C.value=e.data?.version||""}catch{C.value=""}}async function k(){try{const e=await te(),t=e.data?.components||[];h.value=t.some(c=>c.update_available)?e.data:null}catch{h.value=null}}async function X(){try{g.value=!0;const t=(await ue()).data||{};if(t.started||t.success){const c=t.job_id?` (job ${t.job_id})`:"";R(`Update started${c}. Re-open dashboard after the device finishes updating.`)}else x(t.error||"Update command failed to start.");await k()}catch(e){x("Failed to apply update: "+e.message)}finally{g.value=!1}}return Q(async()=>{await q(),await U(),await k(),V=setInterval(()=>{U(),k()},5e3)}),W(()=>{V&&clearInterval(V)}),(e,t)=>(u(),T(K,{class:"pa-4 pa-md-6",fluid:""},{default:s(()=>[a("div",ve,[t[0]||(t[0]=a("div",null,[a("h1",{class:"text-h4 text-md-h3 text-primary-high font-weight-bold mb-1"},"Dashboard"),a("p",{class:"text-body-2 text-secondary"},"At-a-glance device health")],-1)),r(G,{connected:w.value},null,8,["connected"])]),h.value?.components?.length?(u(),T(D,{key:0,class:"mb-4",color:"warning",icon:"mdi-update",type:"warning",variant:"tonal"},{default:s(()=>[a("div",fe,[a("div",null,[t[1]||(t[1]=a("div",{class:"text-subtitle-1 font-weight-bold"},"Update available",-1)),a("div",ye,o(I.value),1)]),r(O,{color:"warning",disabled:g.value,loading:g.value,"prepend-icon":"mdi-download",onClick:X},{default:s(()=>[...t[2]||(t[2]=[d("Update now",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):F("",!0),b.value&&!n.value?(u(),f("div",he,[r(se,{color:"primary",indeterminate:"",size:"64"}),t[3]||(t[3]=a("div",{class:"text-body-1 text-secondary mt-4"},"Loading dashboard...",-1))])):y.value?(u(),T(D,{key:2,class:"mb-6",icon:"mdi-alert-circle",prominent:"",type:"error",variant:"tonal"},{append:s(()=>[r(O,{color:"error",variant:"outlined",onClick:U},{default:s(()=>[...t[4]||(t[4]=[d("Retry",-1)])]),_:1})]),default:s(()=>[t[5]||(t[5]=a("div",{class:"text-h6 mb-2"},"Connection Error",-1)),a("div",ge,o(y.value),1),P.value.length>0?(u(),f("div",_e,[(u(!0),f(re,null,oe(P.value,(c,M)=>(u(),f("div",{key:M},o(c),1))),128))])):F("",!0)]),_:1})):(u(),f("div",xe,[r(L,{elevated:""},{default:s(()=>[r(S,{class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center ga-4"},{default:s(()=>[a("div",null,[t[6]||(t[6]=a("div",{class:"text-overline text-secondary"},"Device summary",-1)),a("div",be,o(n.value?.hostname?.hostname||"CDO Vertex"),1),a("div",we," Uptime "+o(Y(n.value?.uptime?.uptime_seconds||0))+" · API "+o(C.value||"n/a")+" · Dashboard v"+o(ne(B)),1)]),a("div",Ce,[r(_,{color:j(A.value),"prepend-icon":"mdi-chip",variant:"tonal"},{default:s(()=>[d(o(A.value)+"% CPU",1)]),_:1},8,["color"]),r(_,{color:H(E.value),"prepend-icon":"mdi-memory",variant:"tonal"},{default:s(()=>[d(o(E.value)+"% Memory",1)]),_:1},8,["color"]),r(_,{color:j(N.value),"prepend-icon":"mdi-harddisk",variant:"tonal"},{default:s(()=>[d(o(N.value)+"% Disk",1)]),_:1},8,["color"]),r(_,{color:v.value.color,"prepend-icon":"mdi-thermometer",variant:"tonal"},{default:s(()=>[d(o(p.value.toFixed(1))+"°C",1)]),_:1},8,["color"])])]),_:1})]),_:1}),r(de,null,{default:s(()=>[r(ce,{cols:"12",lg:"12",md:"12"},{default:s(()=>[r(L,{class:"h-100 hoverable-card"},{default:s(()=>[r(J,{class:"text-primary-high"},{default:s(()=>[...t[7]||(t[7]=[d("Temperature",-1)])]),_:1}),r(S,null,{default:s(()=>[a("div",Ve,[t[8]||(t[8]=a("span",{class:"text-body-2 text-secondary"},"CPU Temperature",-1)),a("span",{class:le(["text-h5",`text-${v.value.color}`])},o(p.value.toFixed(1))+"°C",3)]),r(ie,{color:v.value.color,height:"12","model-value":Math.min(Math.max(p.value,0),100),rounded:""},null,8,["color","model-value"]),r(D,{class:"mt-3",density:"comfortable",type:v.value.alertType,variant:"tonal"},{default:s(()=>[d(o(v.value.message),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})]),_:1}),a("div",Ue,[a("div",ke,"Last updated: "+o($.value),1)])]))]),_:1}))}};export{Se as default};
