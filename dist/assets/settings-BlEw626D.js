import{c as oe,_ as $,a as j,V as D,b as ie}from"./VContainer-C2PqQUUm.js";import{D as de,E as Y,aU as re,bp as ue,G as ce,H as fe,I as ve,f as a,J as Z,K as me,U as ee,r as i,L as pe,e as o,T as ae,n as te,a7 as ge,bq as ye,C as S,aV as he,k as X,F as be,_ as _e,br as we,x as ke,o as xe,c as Q,w as l,bs as Ve,bt as Ce,u as Se,q,d as f,j as A,h as c,bu as Ue,V as F,i as I,t as N,s as Te,bv as Pe,bw as De,v as Ae}from"./index-BH-1eDVb.js";import{V as Fe,a as Ie}from"./VRow-DqXVCskN.js";import{u as Ne,V as le,a as se,b as Be,m as Re}from"./VInput-CsD2Qi_E.js";import{V as ze}from"./VAlert-vJp_IYB8.js";import{V as Le}from"./VDialog-CU4UL08k.js";import"./dialog-transition-DkY7FnMy.js";const Me=pe({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...Re(),...Be()},"VSwitch"),ne=de()({name:"VSwitch",inheritAttrs:!1,props:Me(),emits:{"update:focused":n=>!0,"update:modelValue":n=>!0,"update:indeterminate":n=>!0},setup(n,y){let{attrs:v,slots:d}=y;const m=Y(n,"indeterminate"),r=Y(n,"modelValue"),{loaderClasses:U}=re(n),{isFocused:p,focus:h,blur:b}=Ne(n),_=i(),w=i(),k=ue&&window.matchMedia("(forced-colors: active)").matches,x=ee(()=>typeof n.loading=="string"&&n.loading!==""?n.loading:n.color),B=ce(),R=ee(()=>n.id||`switch-${B}`);function z(){m.value&&(m.value=!1)}function g(s){s.stopPropagation(),s.preventDefault(),_.value?.input?.click()}return fe(()=>{const[s,T]=ve(v),H=le.filterProps(n),P=se.filterProps(n);return a(le,Z({ref:w,class:["v-switch",{"v-switch--flat":n.flat},{"v-switch--inset":n.inset},{"v-switch--indeterminate":m.value},U.value,n.class]},s,H,{modelValue:r.value,"onUpdate:modelValue":L=>r.value=L,id:R.value,focused:p.value,style:n.style}),{...d,default:L=>{let{id:M,messagesId:G,isDisabled:K,isReadonly:E,isValid:O}=L;const J={model:r,isValid:O};return a(se,Z({ref:_},P,{modelValue:r.value,"onUpdate:modelValue":[V=>r.value=V,z],id:M.value,"aria-describedby":G.value,type:"checkbox","aria-checked":m.value?"mixed":void 0,disabled:K.value,readonly:E.value,onFocus:h,onBlur:b},T),{...d,default:V=>{let{backgroundColorClasses:t,backgroundColorStyles:e}=V;return o("div",{class:te(["v-switch__track",k?void 0:t.value]),style:ae(e.value),onClick:g},[d["track-true"]&&o("div",{key:"prepend",class:"v-switch__track-true"},[d["track-true"](J)]),d["track-false"]&&o("div",{key:"append",class:"v-switch__track-false"},[d["track-false"](J)])])},input:V=>{let{inputNode:t,icon:e,backgroundColorClasses:u,backgroundColorStyles:C}=V;return o(be,null,[t,o("div",{class:te(["v-switch__thumb",{"v-switch__thumb--filled":e||n.loading},n.inset||k?void 0:u.value]),style:ae(n.inset?void 0:C.value)},[d.thumb?a(ge,{defaults:{VIcon:{icon:e,size:"x-small"}}},{default:()=>[d.thumb({...J,icon:e})]}):a(ye,null,{default:()=>[n.loading?a(he,{name:"v-switch",active:!0,color:O.value===!1?void 0:x.value},{default:W=>d.loader?d.loader(W):a(X,{active:W.isActive,color:W.color,indeterminate:!0,size:"16",width:"2"},null)}):e&&a(S,{key:String(e),icon:e,size:"x-small"},null)]})])])}})}})}),me({},w)}}),Ee={key:0,class:"text-center py-16"},Je={key:1},$e={class:"d-flex flex-column ga-3"},Oe={class:"d-flex flex-wrap ga-2"},je={class:"text-body-2"},qe={key:0,class:"text-caption mt-1"},He={class:"d-flex flex-column flex-sm-row gap-3 justify-end"},Ge={key:0,class:"text-caption"},Ke={key:1,class:"text-caption"},We={key:2,class:"text-caption text-error"},Qe=3e3,Xe={__name:"settings",setup(n){const{success:y,error:v}=Se(),d=we(),m=i(!1),r=i(!1),U=i(!1),p=i(null),h=i(!1),b=i(!1),_=i(null),w=i(!1),k=i("Starting update..."),x=i(null),B=i(""),R=i(!1),z=i("");let g=null;const s=i({auto_update:{enabled:!1,check_interval_hours:24,check_time:"03:00",auto_install:!1},notifications:{update_available:!0,installation_complete:!0},display:{theme:"dark",refresh_interval_seconds:5}});function T(t){const e=t==="light"?"light":"dark";d.change(e),localStorage.setItem("vertex-theme",e)}ke(()=>s.value.display.theme,t=>{T(t)});const H=q(()=>p.value?JSON.stringify(p.value)!==JSON.stringify(s.value):!1),P=q(()=>(_.value?.components||[]).some(t=>t.update_available)),L=q(()=>{const t=(_.value?.components||[]).find(e=>e.update_available);return t?`${t.name}: ${t.current_version} â†’ ${t.latest_version}`:""}),M=q(()=>_.value?P.value?{type:"warning",message:'Update available. Click "Update now" to install.'}:{type:"success",message:"Device is up to date."}:null);async function G(){try{m.value=!0;const t=await Ve();p.value=t.data,s.value=structuredClone(t.data),s.value.display.refresh_interval_seconds=5,T(s.value.display.theme)}catch(t){v("Failed to load settings: "+t.message)}finally{m.value=!1}}async function K(){try{r.value=!0,s.value.display.refresh_interval_seconds=5;const t=await De(s.value);p.value=t.data.settings,s.value=structuredClone(t.data.settings),s.value.display.refresh_interval_seconds=5,T(s.value.display.theme),y("Settings saved successfully")}catch(t){v("Failed to save settings: "+t.message)}finally{r.value=!1}}async function E(){try{h.value=!0;const t=await Ce();_.value=t.data,P.value?y("Update available"):y("Device is up to date")}catch(t){v("Failed to check for updates: "+t.message)}finally{h.value=!1}}async function O(){try{b.value=!0;const e=(await Te()).data||{};e.started||e.success?(x.value=e.job_id||null,B.value=e.log_path||"",k.value="Applying update. Please keep this page open.",R.value=!1,z.value="",w.value=!0,x.value&&await V(x.value),y("Update started. The device will restart when finished.")):v(e.error||"Update command failed"),await E()}catch(t){v("Failed to apply updates: "+t.message)}finally{b.value=!1}}async function J(){if(confirm("Are you sure you want to reset all settings to defaults?"))try{U.value=!0;const t=await Pe();p.value=t.data.settings,s.value=structuredClone(t.data.settings),s.value.display.refresh_interval_seconds=5,T(s.value.display.theme),y("Settings reset to defaults")}catch(t){v("Failed to reset settings: "+t.message)}finally{U.value=!1}}xe(async()=>{await G(),await E()}),onUnmounted(()=>{g&&clearTimeout(g)});async function V(t){if(!t)return;const e=async()=>{try{const C=(await Ae(t)).data||{};if(k.value=C.running?"Installing update...":"Finalizing update...",C.finished){if(C.success===!1||C.error){R.value=!0,z.value=C.error||"Update failed. Check the log for details.";return}w.value=!1,window.location.reload();return}}catch{k.value="Waiting for the device to respond..."}g=setTimeout(e,Qe)};g&&clearTimeout(g),g=setTimeout(e,0)}return(t,e)=>(f(),Q(oe,{class:"pa-4 pa-md-6",fluid:""},{default:l(()=>[e[20]||(e[20]=o("div",{class:"mb-6"},[o("h1",{class:"text-h4 text-md-h3 text-primary-high font-weight-bold mb-1"},"Settings"),o("p",{class:"text-body-2 text-secondary"},"Configure theme and notifications")],-1)),m.value&&!p.value?(f(),A("div",Ee,[a(X,{color:"primary",indeterminate:"",size:"64"}),e[4]||(e[4]=o("div",{class:"text-body-1 text-secondary mt-4"},"Loading settings...",-1))])):(f(),A("div",Je,[a(Fe,null,{default:l(()=>[a(Ie,{cols:"12",lg:"6"},{default:l(()=>[a($,{class:"mb-4",elevated:""},{default:l(()=>[a(j,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-palette"}),e[5]||(e[5]=c("Display Settings ",-1))]),_:1}),a(D,null,{default:l(()=>[o("div",null,[e[8]||(e[8]=o("div",{class:"text-body-2 text-primary-medium mb-3"},"Theme",-1)),a(Ue,{modelValue:s.value.display.theme,"onUpdate:modelValue":e[0]||(e[0]=u=>s.value.display.theme=u),class:"w-100",color:"primary",divided:"",mandatory:"",variant:"outlined"},{default:l(()=>[a(F,{class:"flex-1-1",value:"dark"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-weather-night"}),e[6]||(e[6]=c("Dark",-1))]),_:1}),a(F,{class:"flex-1-1",value:"light"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-white-balance-sunny"}),e[7]||(e[7]=c("Light",-1))]),_:1})]),_:1},8,["modelValue"]),e[9]||(e[9]=o("div",{class:"text-caption text-secondary mt-3"},"Dashboard data refresh is fixed at every 5 seconds.",-1))])]),_:1})]),_:1}),a($,{class:"mb-4"},{default:l(()=>[a(j,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-bell"}),e[10]||(e[10]=c("Notifications",-1))]),_:1}),a(D,null,{default:l(()=>[a(ne,{modelValue:s.value.notifications.update_available,"onUpdate:modelValue":e[1]||(e[1]=u=>s.value.notifications.update_available=u),class:"mb-4",color:"primary","hide-details":"",label:"Notify when updates are available"},null,8,["modelValue"]),a(ne,{modelValue:s.value.notifications.installation_complete,"onUpdate:modelValue":e[2]||(e[2]=u=>s.value.notifications.installation_complete=u),color:"primary","hide-details":"",label:"Notify when installation completes"},null,8,["modelValue"])]),_:1})]),_:1}),a($,null,{default:l(()=>[a(j,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-wifi"}),e[11]||(e[11]=c("Network Setup ",-1))]),_:1}),a(D,null,{default:l(()=>[...e[12]||(e[12]=[o("p",{class:"text-body-2 text-secondary mb-0"}," Network onboarding is now handled by the backend host flow before the dashboard loads. ",-1)])]),_:1})]),_:1}),a($,{class:"mt-4"},{default:l(()=>[a(j,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-update"}),e[13]||(e[13]=c("Check for Updates ",-1))]),_:1}),a(D,null,{default:l(()=>[o("div",$e,[e[16]||(e[16]=o("p",{class:"text-body-2 text-secondary mb-0"},"Use this to check for software updates and apply them manually.",-1)),o("div",Oe,[a(F,{color:"primary",disabled:h.value||b.value,loading:h.value,"prepend-icon":"mdi-refresh",variant:"outlined",onClick:E},{default:l(()=>[...e[14]||(e[14]=[c("Check for updates",-1)])]),_:1},8,["disabled","loading"]),P.value?(f(),Q(F,{key:0,color:"warning",disabled:h.value||b.value,loading:b.value,"prepend-icon":"mdi-download",onClick:O},{default:l(()=>[...e[15]||(e[15]=[c("Update now",-1)])]),_:1},8,["disabled","loading"])):I("",!0)]),M.value?(f(),Q(ze,{key:0,density:"comfortable",type:M.value.type,variant:"tonal"},{default:l(()=>[o("div",je,N(M.value.message),1),P.value?(f(),A("div",qe,N(L.value),1)):I("",!0)]),_:1},8,["type"])):I("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),a($,{class:"mt-6"},{default:l(()=>[a(D,null,{default:l(()=>[o("div",He,[a(F,{color:"error",disabled:r.value,loading:U.value,"prepend-icon":"mdi-restore",variant:"outlined",onClick:J},{default:l(()=>[...e[17]||(e[17]=[c("Reset to Defaults",-1)])]),_:1},8,["disabled","loading"]),a(F,{color:"primary",disabled:U.value||!H.value,loading:r.value,"prepend-icon":"mdi-content-save",size:"large",onClick:K},{default:l(()=>[...e[18]||(e[18]=[c("Save Settings",-1)])]),_:1},8,["disabled","loading"])])]),_:1})]),_:1})])),a(Le,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=u=>w.value=u),persistent:"","max-width":"460"},{default:l(()=>[a(ie,{class:"dialog"},{default:l(()=>[a(D,{class:"dialog__body"},{default:l(()=>[a(X,{indeterminate:"",size:"56",width:"5",color:"primary"}),o("div",null,[e[19]||(e[19]=o("h3",null,"Updating device",-1)),o("p",null,N(k.value),1),x.value?(f(),A("p",Ge,"Job "+N(x.value),1)):I("",!0),B.value?(f(),A("p",Ke,"Log: "+N(B.value),1)):I("",!0),R.value?(f(),A("p",We,N(z.value),1)):I("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},na=_e(Xe,[["__scopeId","data-v-38acfa0f"]]);export{na as default};
