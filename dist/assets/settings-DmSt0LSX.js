import{V as oe,_ as J}from"./VContainer-BA4hOVYS.js";import{J as ie,K as Y,a9 as de,bi as re,L as ue,M as ce,N as fe,f as a,O as Z,P as ve,a0 as ee,r as i,Q as me,e as o,$ as ae,q as te,ap as pe,bj as ge,I as S,ae as ye,k as X,F as he,_ as be,bk as _e,B as we,o as ke,a as xe,c as G,w as l,bl as Ve,bm as Ce,u as Se,y as j,d as f,j as A,p as q,h as c,m as D,bn as Ue,V as F,i as N,t as B,v as Te,x as Pe,z as Ae,bo as De,bp as Fe,A as Ne}from"./index-CTEz-c80.js";import{V as Be,a as Ie}from"./VRow-nhWdr4X9.js";import{u as ze,V as le,a as se,b as Re,m as Le}from"./VInput-B5zAA9y7.js";import{V as Me}from"./VAlert-Bpy2NYZG.js";const $e=me({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...Le(),...Re()},"VSwitch"),ne=ie()({name:"VSwitch",inheritAttrs:!1,props:$e(),emits:{"update:focused":n=>!0,"update:modelValue":n=>!0,"update:indeterminate":n=>!0},setup(n,y){let{attrs:v,slots:d}=y;const m=Y(n,"indeterminate"),r=Y(n,"modelValue"),{loaderClasses:U}=de(n),{isFocused:p,focus:h,blur:b}=ze(n),_=i(),w=i(),k=re&&window.matchMedia("(forced-colors: active)").matches,x=ee(()=>typeof n.loading=="string"&&n.loading!==""?n.loading:n.color),I=ue(),z=ee(()=>n.id||`switch-${I}`);function R(){m.value&&(m.value=!1)}function g(s){s.stopPropagation(),s.preventDefault(),_.value?.input?.click()}return ce(()=>{const[s,T]=fe(v),H=le.filterProps(n),P=se.filterProps(n);return a(le,Z({ref:w,class:["v-switch",{"v-switch--flat":n.flat},{"v-switch--inset":n.inset},{"v-switch--indeterminate":m.value},U.value,n.class]},s,H,{modelValue:r.value,"onUpdate:modelValue":L=>r.value=L,id:z.value,focused:p.value,style:n.style}),{...d,default:L=>{let{id:M,messagesId:K,isDisabled:Q,isReadonly:$,isValid:O}=L;const E={model:r,isValid:O};return a(se,Z({ref:_},P,{modelValue:r.value,"onUpdate:modelValue":[V=>r.value=V,R],id:M.value,"aria-describedby":K.value,type:"checkbox","aria-checked":m.value?"mixed":void 0,disabled:Q.value,readonly:$.value,onFocus:h,onBlur:b},T),{...d,default:V=>{let{backgroundColorClasses:t,backgroundColorStyles:e}=V;return o("div",{class:te(["v-switch__track",k?void 0:t.value]),style:ae(e.value),onClick:g},[d["track-true"]&&o("div",{key:"prepend",class:"v-switch__track-true"},[d["track-true"](E)]),d["track-false"]&&o("div",{key:"append",class:"v-switch__track-false"},[d["track-false"](E)])])},input:V=>{let{inputNode:t,icon:e,backgroundColorClasses:u,backgroundColorStyles:C}=V;return o(he,null,[t,o("div",{class:te(["v-switch__thumb",{"v-switch__thumb--filled":e||n.loading},n.inset||k?void 0:u.value]),style:ae(n.inset?void 0:C.value)},[d.thumb?a(pe,{defaults:{VIcon:{icon:e,size:"x-small"}}},{default:()=>[d.thumb({...E,icon:e})]}):a(ge,null,{default:()=>[n.loading?a(ye,{name:"v-switch",active:!0,color:O.value===!1?void 0:x.value},{default:W=>d.loader?d.loader(W):a(X,{active:W.isActive,color:W.color,indeterminate:!0,size:"16",width:"2"},null)}):e&&a(S,{key:String(e),icon:e,size:"x-small"},null)]})])])}})}})}),ve({},w)}}),Ee={key:0,class:"text-center py-16"},Je={key:1},Oe={class:"d-flex flex-column ga-3"},je={class:"d-flex flex-wrap ga-2"},qe={class:"text-body-2"},He={key:0,class:"text-caption mt-1"},Ke={class:"d-flex flex-column flex-sm-row gap-3 justify-end"},Qe={key:0,class:"text-caption"},We={key:1,class:"text-caption"},Ge={key:2,class:"text-caption text-error"},Xe=3e3,Ye={__name:"settings",setup(n){const{success:y,error:v}=Se(),d=_e(),m=i(!1),r=i(!1),U=i(!1),p=i(null),h=i(!1),b=i(!1),_=i(null),w=i(!1),k=i("Starting update..."),x=i(null),I=i(""),z=i(!1),R=i("");let g=null;const s=i({auto_update:{enabled:!1,check_interval_hours:24,check_time:"03:00",auto_install:!1},notifications:{update_available:!0,installation_complete:!0},display:{theme:"dark",refresh_interval_seconds:5}});function T(t){const e=t==="light"?"light":"dark";d.change(e),localStorage.setItem("vertex-theme",e)}we(()=>s.value.display.theme,t=>{T(t)});const H=j(()=>p.value?JSON.stringify(p.value)!==JSON.stringify(s.value):!1),P=j(()=>(_.value?.components||[]).some(t=>t.update_available)),L=j(()=>{const t=(_.value?.components||[]).find(e=>e.update_available);return t?`${t.name}: ${t.current_version} â†’ ${t.latest_version}`:""}),M=j(()=>_.value?P.value?{type:"warning",message:'Update available. Click "Update now" to install.'}:{type:"success",message:"Device is up to date."}:null);async function K(){try{m.value=!0;const t=await Ve();p.value=t.data,s.value=structuredClone(t.data),s.value.display.refresh_interval_seconds=5,T(s.value.display.theme)}catch(t){v("Failed to load settings: "+t.message)}finally{m.value=!1}}async function Q(){try{r.value=!0,s.value.display.refresh_interval_seconds=5;const t=await Fe(s.value);p.value=t.data.settings,s.value=structuredClone(t.data.settings),s.value.display.refresh_interval_seconds=5,T(s.value.display.theme),y("Settings saved successfully")}catch(t){v("Failed to save settings: "+t.message)}finally{r.value=!1}}async function $(){try{h.value=!0;const t=await Ce();_.value=t.data,P.value?y("Update available"):y("Device is up to date")}catch(t){v("Failed to check for updates: "+t.message)}finally{h.value=!1}}async function O(){try{b.value=!0;const e=(await Ae()).data||{};e.started||e.success?(x.value=e.job_id||null,I.value=e.log_path||"",k.value="Applying update. Please keep this page open.",z.value=!1,R.value="",w.value=!0,x.value&&await V(x.value),y("Update started. The device will restart when finished.")):v(e.error||"Update command failed"),await $()}catch(t){v("Failed to apply updates: "+t.message)}finally{b.value=!1}}async function E(){if(confirm("Are you sure you want to reset all settings to defaults?"))try{U.value=!0;const t=await De();p.value=t.data.settings,s.value=structuredClone(t.data.settings),s.value.display.refresh_interval_seconds=5,T(s.value.display.theme),y("Settings reset to defaults")}catch(t){v("Failed to reset settings: "+t.message)}finally{U.value=!1}}ke(async()=>{await K(),await $()}),xe(()=>{g&&clearTimeout(g)});async function V(t){if(!t)return;const e=async()=>{try{const C=(await Ne(t)).data||{};if(k.value=C.running?"Installing update...":"Finalizing update...",C.finished){if(C.success===!1||C.error){z.value=!0,R.value=C.error||"Update failed. Check the log for details.";return}w.value=!1,window.location.reload();return}}catch{k.value="Waiting for the device to respond..."}g=setTimeout(e,Xe)};g&&clearTimeout(g),g=setTimeout(e,0)}return(t,e)=>(f(),G(oe,{class:"pa-4 pa-md-6",fluid:""},{default:l(()=>[e[20]||(e[20]=o("div",{class:"mb-6"},[o("h1",{class:"text-h4 text-md-h3 text-primary-high font-weight-bold mb-1"},"Settings"),o("p",{class:"text-body-2 text-secondary"},"Configure theme and notifications")],-1)),m.value&&!p.value?(f(),A("div",Ee,[a(X,{color:"primary",indeterminate:"",size:"64"}),e[4]||(e[4]=o("div",{class:"text-body-1 text-secondary mt-4"},"Loading settings...",-1))])):(f(),A("div",Je,[a(Be,null,{default:l(()=>[a(Ie,{cols:"12",lg:"6"},{default:l(()=>[a(J,{class:"mb-4",elevated:""},{default:l(()=>[a(q,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-palette"}),e[5]||(e[5]=c("Display Settings ",-1))]),_:1}),a(D,null,{default:l(()=>[o("div",null,[e[8]||(e[8]=o("div",{class:"text-body-2 text-primary-medium mb-3"},"Theme",-1)),a(Ue,{modelValue:s.value.display.theme,"onUpdate:modelValue":e[0]||(e[0]=u=>s.value.display.theme=u),class:"w-100",color:"primary",divided:"",mandatory:"",variant:"outlined"},{default:l(()=>[a(F,{class:"flex-1-1",value:"dark"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-weather-night"}),e[6]||(e[6]=c("Dark",-1))]),_:1}),a(F,{class:"flex-1-1",value:"light"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-white-balance-sunny"}),e[7]||(e[7]=c("Light",-1))]),_:1})]),_:1},8,["modelValue"]),e[9]||(e[9]=o("div",{class:"text-caption text-secondary mt-3"},"Dashboard data refresh is fixed at every 5 seconds.",-1))])]),_:1})]),_:1}),a(J,{class:"mb-4"},{default:l(()=>[a(q,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-bell"}),e[10]||(e[10]=c("Notifications",-1))]),_:1}),a(D,null,{default:l(()=>[a(ne,{modelValue:s.value.notifications.update_available,"onUpdate:modelValue":e[1]||(e[1]=u=>s.value.notifications.update_available=u),class:"mb-4",color:"primary","hide-details":"",label:"Notify when updates are available"},null,8,["modelValue"]),a(ne,{modelValue:s.value.notifications.installation_complete,"onUpdate:modelValue":e[2]||(e[2]=u=>s.value.notifications.installation_complete=u),color:"primary","hide-details":"",label:"Notify when installation completes"},null,8,["modelValue"])]),_:1})]),_:1}),a(J,null,{default:l(()=>[a(q,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-wifi"}),e[11]||(e[11]=c("Network Setup ",-1))]),_:1}),a(D,null,{default:l(()=>[...e[12]||(e[12]=[o("p",{class:"text-body-2 text-secondary mb-0"}," Network onboarding is now handled by the backend host flow before the dashboard loads. ",-1)])]),_:1})]),_:1}),a(J,{class:"mt-4"},{default:l(()=>[a(q,{class:"text-primary-high d-flex align-center"},{default:l(()=>[a(S,{class:"mr-2",icon:"mdi-update"}),e[13]||(e[13]=c("Check for Updates ",-1))]),_:1}),a(D,null,{default:l(()=>[o("div",Oe,[e[16]||(e[16]=o("p",{class:"text-body-2 text-secondary mb-0"},"Use this to check for software updates and apply them manually.",-1)),o("div",je,[a(F,{color:"primary",disabled:h.value||b.value,loading:h.value,"prepend-icon":"mdi-refresh",variant:"outlined",onClick:$},{default:l(()=>[...e[14]||(e[14]=[c("Check for updates",-1)])]),_:1},8,["disabled","loading"]),P.value?(f(),G(F,{key:0,color:"warning",disabled:h.value||b.value,loading:b.value,"prepend-icon":"mdi-download",onClick:O},{default:l(()=>[...e[15]||(e[15]=[c("Update now",-1)])]),_:1},8,["disabled","loading"])):N("",!0)]),M.value?(f(),G(Me,{key:0,density:"comfortable",type:M.value.type,variant:"tonal"},{default:l(()=>[o("div",qe,B(M.value.message),1),P.value?(f(),A("div",He,B(L.value),1)):N("",!0)]),_:1},8,["type"])):N("",!0)])]),_:1})]),_:1})]),_:1})]),_:1}),a(J,{class:"mt-6"},{default:l(()=>[a(D,null,{default:l(()=>[o("div",Ke,[a(F,{color:"error",disabled:r.value,loading:U.value,"prepend-icon":"mdi-restore",variant:"outlined",onClick:E},{default:l(()=>[...e[17]||(e[17]=[c("Reset to Defaults",-1)])]),_:1},8,["disabled","loading"]),a(F,{color:"primary",disabled:U.value||!H.value,loading:r.value,"prepend-icon":"mdi-content-save",size:"large",onClick:Q},{default:l(()=>[...e[18]||(e[18]=[c("Save Settings",-1)])]),_:1},8,["disabled","loading"])])]),_:1})]),_:1})])),a(Te,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=u=>w.value=u),persistent:"","max-width":"460"},{default:l(()=>[a(Pe,{class:"dialog"},{default:l(()=>[a(D,{class:"dialog__body"},{default:l(()=>[a(X,{indeterminate:"",size:"56",width:"5",color:"primary"}),o("div",null,[e[19]||(e[19]=o("h3",null,"Updating device",-1)),o("p",null,B(k.value),1),x.value?(f(),A("p",Qe,"Job "+B(x.value),1)):N("",!0),I.value?(f(),A("p",We,"Log: "+B(I.value),1)):N("",!0),z.value?(f(),A("p",Ge,B(R.value),1)):N("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},sa=be(Ye,[["__scopeId","data-v-46bf4170"]]);export{sa as default};
