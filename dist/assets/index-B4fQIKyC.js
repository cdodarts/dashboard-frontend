import{D as ue,E as ce,G as ve,H as pe,I as fe,h as a,J as Q,K as me,r as d,L as ye,M as W,_ as ge,x as be,o as xe,a as he,c as H,w as o,y as we,N as _e,b as ke,u as Ve,A as Ae,e as r,f as s,V as C,n as Ce,i as p,j as O,k as i,l as Y,t as f,C as L,s as X,O as Ie,P as Se,Q as Ue}from"./index-ByZU1jn9.js";import{b as Be,_ as F,V as $,a as q}from"./VContainer-BMR2f8gZ.js";import{_ as Le}from"./StatusBadge-DWx1Zsbu.js";import{V as Z}from"./VAlert-D7jMvYQU.js";import{V as Pe,a as ee}from"./VRow-DmYayam2.js";import{V as Me}from"./VDivider-Cw0M41f_.js";import{V as te,m as ze,a as Fe,b as $e}from"./VSelect-Bc-IUTtB.js";import{u as Ne,V as ae,m as je}from"./VInput-DliR8ZC8.js";import"./VChip-DzKLjb3U.js";const Re=ye({...W(je(),["direction"]),...W(ze(),["inline"])},"VCheckbox"),De=ue()({name:"VCheckbox",inheritAttrs:!1,props:Re(),emits:{"update:modelValue":u=>!0,"update:focused":u=>!0},setup(u,N){let{attrs:w,slots:m}=N;const y=ce(u,"modelValue"),{isFocused:l,focus:c,blur:I}=Ne(u),b=d(),x=ve();return pe(()=>{const[_,k]=fe(w),S=ae.filterProps(u),V=te.filterProps(u);return a(ae,Q({ref:b,class:["v-checkbox",u.class]},_,S,{modelValue:y.value,"onUpdate:modelValue":v=>y.value=v,id:u.id||`checkbox-${x}`,focused:l.value,style:u.style}),{...m,default:v=>{let{id:h,messagesId:P,isDisabled:j,isReadonly:R,isValid:D}=v;return a(te,Q(V,{id:h.value,"aria-describedby":P.value,disabled:j.value,readonly:R.value},k,{error:D.value===!1,modelValue:y.value,"onUpdate:modelValue":A=>y.value=A,onFocus:c,onBlur:I}),m)}})}),me({},b)}}),Ee={class:"mb-4 d-flex flex-wrap align-center justify-space-between gap-3"},Te={key:1,class:"text-center py-16"},He={key:2},Oe={class:"d-flex align-center justify-space-between mb-4"},qe={key:0},Ge={class:"d-flex justify-space-between align-center mb-3"},Je={class:"text-h6 text-primary-high font-weight-bold"},Ke={class:"d-flex justify-space-between align-center mb-3"},Qe={class:"text-body-2 text-primary-medium"},We={class:"d-flex justify-space-between align-center"},Ye={key:1,class:"text-center py-6"},Xe={class:"text-caption text-secondary mt-2"},Ze={key:0,class:"text-caption text-secondary mt-1"},et=["href"],tt={key:0},at={key:1},st={key:0,class:"mb-4"},lt={class:"text-body-2"},ot={key:1,class:"text-center py-6"},nt={class:"d-flex gap-2"},rt={key:0,class:"text-center py-8"},it={key:1,class:"logs-container"},dt={class:"logs-content"},ut={key:2,class:"text-center py-8"},ct={__name:"index",setup(u){const N=Ae(),{success:w,error:m}=Ve(),y=d(!1),l=d(null),c=d(null),I=d(!1),b=d(!1),x=d(""),_=d(100),k=d(""),S=d(!0),V=d(""),v=d(null);let h=null;function P(){if(!l.value?.installed)return"Not Installed";const t=R(v.value?.status||v.value?.event);return t||(v.value?.connected?v.value?.running?"Running":"Stopped":l.value?.active?"Running":"Stopped")}function j(){const t=P().toLowerCase();return t==="running"?"success":t==="starting"?"info":t==="calibrating"?"warning":"neutral"}function R(t){const e=String(t||"").toLowerCase();return e?e.includes("start")?"Starting":e.includes("calibrat")?"Calibrating":e.includes("run")?"Running":e.includes("stop")?"Stopped":"":""}function D(t){const e=String(t?.message||"").toLowerCase();return t?.status===404||t?.status===502||t?.status===503||e.includes("not running")||e.includes("not installed")||e.includes("not found")}async function A(){try{y.value=!0;const t=await we();l.value=t.data,M()}catch(t){if(D(t)){l.value={installed:!1,active:!1,manager_available:!1},E();return}m("Failed to fetch Autodarts status: "+t.message)}finally{y.value=!1}}async function U(){try{b.value=!0;const t=await _e(_.value);x.value=t.data?.logs||"No logs available"}catch(t){m("Failed to fetch logs: "+t.message),x.value="Failed to load logs"}finally{b.value=!1}}function se(t){const e=window.location.protocol==="https:"?"https":"http",n="/api/state",g=n.startsWith("/")?n:`/${n}`;return`${e}://${t}:3180${g}`}async function G(){const e=se("cdo-vertex.local");try{const n=await fetch(e,{cache:"no-store"});if(!n.ok)throw new Error("Board Manager request failed");v.value=await n.json()}catch{v.value=null}}function le(){h||(G(),h=setInterval(G,1e3))}function E(){h&&(clearInterval(h),h=null)}function M(){l.value?.installed?le():E()}const J=X(()=>"http://cdo-vertex.local:3180"),T=X(()=>V.value?`http://${V.value}:3180`:"");function oe(t){const e=t?.interfaces||{},n=Object.entries(e).filter(([g])=>!g.toLowerCase().includes("lo")).sort(([g],[K])=>{const B=z=>z.includes("wlan")?0:z.includes("eth")?1:2;return B(g.toLowerCase())-B(K.toLowerCase())});for(const[,g]of n){const B=(Array.isArray(g?.addresses)?g.addresses:[]).find(z=>(z.type||"").toLowerCase()==="ipv4");if(B?.address)return B.address}return""}async function ne(){try{const t=await ke();V.value=oe(t.data?.network)}catch{V.value=""}}async function re(){try{c.value="install";const t={enable_autostart:S.value};k.value&&(t.version=k.value),await Ie(t),w("Autodarts installed successfully"),await A(),await U(),M()}catch(t){m("Failed to install Autodarts: "+t.message)}finally{c.value=null}}async function ie(){try{c.value="update",await Se(),w("Autodarts updated successfully"),await A(),await U(),M()}catch(t){m("Failed to update Autodarts: "+t.message)}finally{c.value=null}}async function de(){try{I.value=!0;const t=await Ue();await A(),t.data?.update_available?w(`Update available: v${t.data.latest_version}`):w("No updates available")}catch(t){m("Failed to check for updates: "+t.message)}finally{I.value=!1}}return be(_,()=>{l.value?.installed&&U()}),xe(async()=>{await A(),l.value?.installed&&await U(),await ne(),M()}),he(()=>{E()}),(t,e)=>(r(),H(Be,{class:"pa-4 pa-md-6",fluid:""},{default:o(()=>[s("div",Ee,[e[5]||(e[5]=s("div",null,[s("h1",{class:"text-h4 text-md-h3 text-primary-high font-weight-bold mb-1"},"Autodarts"),s("p",{class:"text-body-2 text-secondary"},"Install, update, and control the Autodarts service")],-1)),a(C,{"prepend-icon":"mdi-arrow-left",variant:"text",onClick:e[0]||(e[0]=n=>Ce(N).push("/apps"))},{default:o(()=>[...e[4]||(e[4]=[p("Back to Apps",-1)])]),_:1})]),l.value&&!l.value.manager_available?(r(),H(Z,{key:0,class:"mb-6",icon:"mdi-alert",prominent:"",type:"warning",variant:"tonal"},{default:o(()=>[...e[6]||(e[6]=[s("div",{class:"text-h6 mb-2"},"Autodarts Not Installed",-1),s("div",{class:"text-body-2"},"Install Autodarts to finish setup.",-1)])]),_:1})):O("",!0),y.value&&!l.value?(r(),i("div",Te,[a(Y,{color:"primary",indeterminate:"",size:"64"}),e[7]||(e[7]=s("div",{class:"text-body-1 text-secondary mt-4"},"Loading Autodarts status...",-1))])):(r(),i("div",He,[a(Pe,null,{default:o(()=>[a(ee,{cols:"12",lg:"6"},{default:o(()=>[a(F,{class:"mb-4",elevated:""},{default:o(()=>[a($,null,{default:o(()=>[s("div",Oe,[s("div",null,[e[8]||(e[8]=s("div",{class:"text-caption text-secondary mb-2"},"Service Status",-1)),a(Le,{variant:l.value?.installed?j():"neutral"},{default:o(()=>[p(f(P()),1)]),_:1},8,["variant"])]),a(L,{color:"primary",icon:"mdi-bullseye-arrow",size:"56",style:{opacity:"0.3"}})]),a(Me,{class:"my-4",style:{opacity:"0.1"}}),l.value?.installed?(r(),i("div",qe,[s("div",Ge,[e[9]||(e[9]=s("span",{class:"text-body-2 text-secondary"},"Installed Version:",-1)),s("span",Je,"v"+f(l.value.version),1)]),s("div",Ke,[e[10]||(e[10]=s("span",{class:"text-body-2 text-secondary"},"Latest Version:",-1)),s("span",Qe,"v"+f(l.value.latest_version),1)]),s("div",We,[e[11]||(e[11]=s("span",{class:"text-body-2 text-secondary"},"Autostart Enabled:",-1)),a(L,{color:l.value.enabled?"success":"secondary",icon:l.value.enabled?"mdi-check-circle":"mdi-close-circle",size:"20"},null,8,["color","icon"])])])):(r(),i("div",Ye,[a(L,{color:"secondary",icon:"mdi-package-variant",size:"64",style:{opacity:"0.3"}}),e[12]||(e[12]=s("div",{class:"text-body-2 text-secondary mt-3"},"Autodarts is not installed",-1))]))]),_:1})]),_:1}),l.value?.installed?(r(),H(F,{key:0,class:"mb-4"},{default:o(()=>[a(q,{class:"text-primary-high"},{default:o(()=>[...e[13]||(e[13]=[p("Board Manager",-1)])]),_:1}),a($,null,{default:o(()=>[a(C,{block:"",color:"primary",href:J.value,"prepend-icon":"mdi-open-in-new",rel:"noopener",size:"large",target:"_blank"},{default:o(()=>[...e[14]||(e[14]=[p("Open Board Manager",-1)])]),_:1},8,["href"]),s("div",Xe,f(J.value),1),T.value?(r(),i("div",Ze,[e[15]||(e[15]=p(" If that does not open, try ",-1)),s("a",{href:T.value,rel:"noopener",target:"_blank"},f(T.value),9,et)])):O("",!0)]),_:1})]),_:1})):O("",!0),a(F,null,{default:o(()=>[a(q,{class:"text-primary-high"},{default:o(()=>[p(f(l.value?.installed?"Update Autodarts":"Install Autodarts"),1)]),_:1}),a($,null,{default:o(()=>[l.value?.installed?(r(),i("div",at,[l.value.update_available?(r(),i("div",st,[a(Z,{icon:"mdi-arrow-up-circle",prominent:"",type:"info",variant:"tonal"},{default:o(()=>[e[17]||(e[17]=s("div",{class:"text-body-1 font-weight-medium mb-1"},"Update Available",-1)),s("div",lt,"A new version (v"+f(l.value.latest_version)+") is available.",1)]),_:1}),a(C,{block:"",color:"primary",disabled:c.value!==null,loading:c.value==="update","prepend-icon":"mdi-arrow-up-circle",size:"large",onClick:ie},{default:o(()=>[p(" Update to v"+f(l.value.latest_version),1)]),_:1},8,["disabled","loading"])])):(r(),i("div",ot,[a(L,{color:"success",icon:"mdi-check-circle",size:"64",style:{opacity:"0.3"}}),e[18]||(e[18]=s("div",{class:"text-body-1 text-success font-weight-medium mt-3"},"Up to Date",-1)),e[19]||(e[19]=s("div",{class:"text-caption text-secondary"},"You have the latest version installed",-1))])),a(C,{block:"",class:"mt-3",color:"primary",loading:I.value,"prepend-icon":"mdi-refresh",variant:"outlined",onClick:de},{default:o(()=>[...e[20]||(e[20]=[p("Check for Updates",-1)])]),_:1},8,["loading"])])):(r(),i("div",tt,[a(Fe,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=n=>k.value=n),class:"mb-4",density:"comfortable",hint:"e.g., 0.20.0",label:"Version (leave empty for latest)","persistent-hint":"",variant:"outlined"},null,8,["modelValue"]),a(De,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=n=>S.value=n),class:"mb-4",color:"primary","hide-details":"",label:"Enable autostart"},null,8,["modelValue"]),a(C,{block:"",color:"primary",disabled:c.value!==null,loading:c.value==="install","prepend-icon":"mdi-download",size:"large",onClick:re},{default:o(()=>[...e[16]||(e[16]=[p(" Install Autodarts ",-1)])]),_:1},8,["disabled","loading"])]))]),_:1})]),_:1})]),_:1}),a(ee,{cols:"12",lg:"6"},{default:o(()=>[a(F,{class:"logs-card"},{default:o(()=>[a(q,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[21]||(e[21]=s("span",{class:"text-primary-high"},"Service Logs",-1)),s("div",nt,[a($e,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=n=>_.value=n),density:"compact","hide-details":"",items:[10,25,50,100,200,500],style:{"max-width":"100px"},variant:"outlined"},null,8,["modelValue"]),a(C,{icon:"mdi-refresh",loading:b.value,size:"small",variant:"text",onClick:U},null,8,["loading"])])]),_:1}),a($,null,{default:o(()=>[b.value&&!x.value?(r(),i("div",rt,[a(Y,{color:"primary",indeterminate:"",size:"48"})])):x.value?(r(),i("div",it,[s("pre",dt,f(x.value),1)])):(r(),i("div",ut,[a(L,{color:"secondary",icon:"mdi-text-box-outline",size:"48",style:{opacity:"0.3"}}),e[22]||(e[22]=s("div",{class:"text-caption text-secondary mt-2"},"No logs available",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]))]),_:1}))}},wt=ge(ct,[["__scopeId","data-v-88bc8b7d"]]);export{wt as default};
